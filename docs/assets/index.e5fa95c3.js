var e=Object.defineProperty,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,n=(t,o,r)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[o]=r,s=(e,s)=>{for(var i in s||(s={}))o.call(s,i)&&n(e,i,s[i]);if(t)for(var i of t(s))r.call(s,i)&&n(e,i,s[i]);return e};import{r as i,R as l,a as c}from"./vendor.c61d7abd.js";const u=e=>{let t=[];for(let o=0;o<e;o++)t.push(s({},{x:Math.floor(370*Math.random()),y:-Math.floor(200*Math.random()),isOver:!1,width:30,height:36,boomIndex:0,ifDel:!1,hp:3}));return t};function a(){let e=0;const t=i.exports.useRef(null),o=i.exports.useRef({isLeft:!1,isTop:!1,isRight:!1,isBottom:!1}),r=i.exports.useRef({x:0,y:0,width:30,height:36,boomIndex:0,isOver:!1,ifDel:!1,hp:0});let n=[];const s=u(10),c=()=>null==r?void 0:r.current,a=i.exports.useMemo((()=>{const e=new Image;return e.src="./assets/plane.png",e}),[]),d=i.exports.useMemo((()=>{const e=new Image;return e.src="./assets/background.png",e}),[]),h=i.exports.useMemo((()=>{const e=new Image;return e.src="./assets/enemy.png",e}),[]),v=i.exports.useMemo((()=>{const e=new Image;return e.src="./assets/bullet.png",e}),[]),m=i.exports.useMemo((()=>{const e=new Image;return e.src="./assets/boom.png",e}),[]),y=(e,t)=>{const o=e.x,r=e.x+e.width,n=e.y,s=e.y+e.height,i=t.x,l=t.x+t.width,c=t.y,u=t.y+t.height;return!(r<i||o>l||n>u||s<c)},p=(e,t,o,r,n)=>{e.beginPath(),e.lineWidth=3,e.strokeStyle="white",e.lineTo(t,o-5),e.lineTo(t+r,o-5),e.stroke(),e.closePath(),e.beginPath(),e.lineWidth=3,e.strokeStyle="green",e.lineTo(t,o-5),e.lineTo(t+r*n,o-5),e.stroke(),e.closePath()},g=e=>{(()=>{if(s.length<10){const e=10-s.length;s.push(...u(e))}s.forEach((e=>{e.y=(null==e?void 0:e.y)+1,e.y>400+e.height&&(e.ifDel=!0,e.isOver=!0)}))})();const t=c();for(let o=0;o<(null==s?void 0:s.length);o++){const r=s[o];for(let e=0;e<(null==n?void 0:n.length);e++){const t=n[e];(null==r?void 0:r.isOver)||(null==t?void 0:t.isOver)||!y(t,r)||(r.hp=r.hp-1,t.isOver=!0,r.hp<=0&&(r.isOver=!0))}if(!(null==r?void 0:r.isOver)&&y(t,r)&&(r.isOver=!0),null==r?void 0:r.isOver){if(null==r?void 0:r.ifDel){s.splice(o,1),o--;continue}e.drawImage(m,64*(null==r?void 0:r.boomIndex),0,64,64,null==r?void 0:r.x,null==r?void 0:r.y,null==r?void 0:r.width,null==r?void 0:r.height),r.boomIndex=r.boomIndex+1,r.boomIndex>=14&&(r.ifDel=!0)}else p(e,null==r?void 0:r.x,null==r?void 0:r.y,null==r?void 0:r.width,(null==r?void 0:r.hp)/3),e.drawImage(h,null==r?void 0:r.x,null==r?void 0:r.y,null==r?void 0:r.width,null==r?void 0:r.height)}},f=()=>{const s=(()=>{const e=null==t?void 0:t.current;return null==e?void 0:e.getContext("2d")})();s&&((e=>{null==e||e.clearRect(0,0,400,400)})(s),s.drawImage(d,0,0,400,400),g(s),(e=>{const{isLeft:t,isTop:n,isRight:s,isBottom:i}=o.current,l=null==r?void 0:r.current;t&&(l.x=l.x-4,l.x<0&&(l.x=0)),n&&(l.y=l.y-4,l.y<0&&(l.y=0)),s&&(l.x=l.x+4,l.x>370&&(l.x=370)),i&&(l.y=l.y+4,l.y>364&&(l.y=364)),e.drawImage(a,l.x,l.y,l.width,l.height)})(s),(t=>{const{x:o,y:r}=c();n.forEach((e=>{e.y=e.y+-5})),n=n.filter((e=>e.y>-5||!(null==e?void 0:e.isOver))),e%3==0&&n.push({x:o+15-1.5,y:r-5,width:3,height:5,isOver:!1,ifDel:!1,boomIndex:0,hp:0}),n.forEach((e=>{t.drawImage(v,e.x,e.y,3,5)})),e++})(s))},w=()=>{const e=[a,d,h,v,m];return Promise.all(e.map((e=>new Promise(((t,o)=>{(null==e?void 0:e.complete)?t():e.onload=()=>{t()}}))))).then((()=>!0)).catch((()=>!1))};return i.exports.useEffect((()=>{const e=()=>{requestAnimationFrame((async()=>{await w()&&f(),e()}))};(async()=>{const e=r.current;e.x=185,e.y=364})(),e()}),[f,w]),i.exports.useEffect((()=>{const e=async e=>{switch(null==e?void 0:e.key){case"ArrowLeft":o.current.isLeft=!0;break;case"ArrowUp":o.current.isTop=!0;break;case"ArrowRight":o.current.isRight=!0;break;case"ArrowDown":o.current.isBottom=!0}},t=e=>{switch(null==e?void 0:e.key){case"ArrowLeft":o.current.isLeft=!1;break;case"ArrowUp":o.current.isTop=!1;break;case"ArrowRight":o.current.isRight=!1;break;case"ArrowDown":o.current.isBottom=!1}};return document.addEventListener("keydown",e),document.addEventListener("keyup",t),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keyup",t)}}),[]),l.createElement("canvas",{ref:t,width:400,height:400},"您的浏览器不支持canvas")}c.render(l.createElement(l.StrictMode,null,l.createElement(a,null)),document.getElementById("root"));
